# BeeaNexus - 系统设计文档

## 3.1 架构设计

### 3.1.1 三层架构
系统采用经典的三层架构设计，包含以下三个层次：

1. **展示层（客户端）**：
   - 负责与用户交互，提供图形化界面（GUI）。
   - 使用 PyQt5 构建桌面应用程序，用户可通过界面进行注册、登录、聊天、查看排行榜等操作。
   - 客户端通过 TCP 协议与服务端进行通信，发送用户请求并接收服务端响应。

2. **应用层（服务端）**：
   - 担当业务逻辑的核心处理层，接收客户端请求并返回相应结果。
   - 使用 Python 实现，基于 `socketserver` 模块构建 TCP 服务器。
   - 对客户端请求进行解析，调用业务逻辑函数（如用户管理、消息处理等），并与数据库交互。
   - 服务端维护用户在线状态，支持实时消息推送。

3. **数据层（数据库）**：
   - 使用 MySQL 数据库存储系统数据，包括用户信息、消息记录、白名单申请等。
   - 数据库设计包含多个表，通过关系模型组织数据，确保数据的一致性和完整性。
   - 提供数据的增删改查功能，支持服务端的业务逻辑操作。

### 组件设计：
系统主要划分为以下模块及其接口：
- **网络模块**：负责客户端与服务端之间的 TCP 通信，包括消息的发送与接收。
- **数据库模块**：封装了对 MySQL 数据库的操作，提供用户管理、消息存储、白名单管理等功能。
- **UI 模块**：构建客户端的图形化界面，包括主界面、登录/注册界面、消息聊天界面、管理员面板等。
- **业务逻辑模块**：处理系统的核心业务功能，如用户注册/登录、即时通讯、白名单申请与审核、签到奖励等。

## 3.2 数据库设计

### 3.2.1 ER 图
系统数据库的实体关系图（ER 图）包含以下几个核心实体及其关系：
- **用户（Users）**：存储用户的基本信息，如用户名、密码、昵称、邮箱、手机号等。
- **用户角色（UserRoles_Con）**：定义用户的权限等级。
- **玩家数据（PlayerData）**：存储与游戏相关的数据，如白名单状态、游戏内名字、UUID 等。
- **消息（messages）**：记录用户之间的聊天消息，包括发送者、接收者、消息内容、时间戳等。
- **联系人备注（contacts）**：保存用户对联系人的备注信息。

（具体 ER 图需要通过数据库建模工具如 MySQL Workbench 绘制）

### 3.2.2 表结构

1. **Users 表**：
   - `UserID` (INT, 主键, 自增)：用户唯一标识符。
   - `Username` (VARCHAR(50))：用户名。
   - `Password` (VARCHAR(128))：加密后的用户密码。
   - `Nickname` (VARCHAR(50))：用户昵称。
   - `Email` (VARCHAR(100))：用户邮箱。
   - `Phone` (VARCHAR(20))：用户手机号。
   - `CreatedAt` (DATETIME)：账户创建时间。
   - `UpdatedAt` (DATETIME)：账户更新时间。
   - `last_online` (DATETIME)：最后在线时间。
   - `Coins` (INT)：用户拥有的金币数量。
   - `Stars` (INT)：用户拥有的星星数量。

2. **UserRoles 表**：
   - `RoleID` (INT, 主键, 自增)：角色唯一标识符。
   - `RoleName` (VARCHAR(50))：角色名称。

3. **UserRoles_Con 表**：
   - `UserID` (INT, 主键)：用户 ID，与 Users 表关联。
   - `RoleID` (INT, 主键)：角色 ID，与 UserRoles 表关联。

4. **PlayerData 表**：
   - `PlayerID` (INT, 主键, 自增)：玩家唯一标识符。
   - `UserID` (INT)：用户 ID，与 Users 表关联。
   - `PlayerName` (CHAR(32))：游戏内玩家名。
   - `uuid` (CHAR(32))：玩家游戏内的 UUID。
   - `WhiteState` (BIT(1))：白名单状态（0-未通过，1-已通过）。
   - `Genuine` (BIT(1))：账号类型（0-离线，1-正版）。
   - `PassDate` (DATE)：通过白名单的日期。

5. **messages 表**：
   - `MessageID` (INT, 主键, 自增)：消息唯一标识符。
   - `sender_id` (INT)：发送者用户 ID。
   - `receiver_id` (INT)：接收者用户 ID。
   - `content` (TEXT)：消息内容。
   - `timestamp` (DATETIME)：消息发送时间。
   - `visible_to_sender` (TINYINT(1))：消息对发送者是否可见。
   - `visible_to_receiver` (TINYINT(1))：消息对接收者是否可见。
   - `is_read` (TINYINT(1))：消息是否已读。

6. **UserProfiles 表**：
   - `UserID` (INT, 主键)：用户 ID，与 Users 表关联。
   - `FirstName` (VARCHAR(50))：用户姓名。
   - `LastName` (VARCHAR(50))：用户姓氏。
   - `Birthday` (DATE)：用户生日。
   - `Gender` (VARCHAR(10))：用户性别。
   - `Bio` (VARCHAR(255))：用户个人简介。

7. **UserQQ_Con 表**：
   - `UserID` (INT, 主键)：用户 ID，与 Users 表关联。
   - `QQID` (CHAR(16), 主键)：用户绑定的 QQ 号。

8. **UserLoginRecords 表**：
   - `RecordID` (INT, 主键, 自增)：登录记录唯一标识符。
   - `UserID` (INT)：用户 ID，与 Users 表关联。
   - `LoginTime` (DATETIME)：登录时间。
   - `IPAddress` (VARCHAR(15))：登录 IP 地址。
   - `Address` (VARCHAR(100))：登录地理位置。

## 3.3 界面设计

### 3.3.1 界面原型
系统的主要界面包括：
1. **主界面**：
   - 包含导航栏，用户可通过导航栏切换至不同功能模块（如主页、签到/排行、个人资料、白名单申请、即时通讯等）。
   - 显示用户的基本状态（如登录状态、未读消息数）。

2. **登录/注册界面**：
   - 提供用户登录和注册的功能入口。
   - 用户需输入用户名、密码等信息进行登录，或填写表单进行注册。

3. **即时通讯界面**：
   - 显示联系人列表，支持用户添加、删除联系人。
   - 提供聊天窗口，用户可发送和接收消息，支持查看历史消息。
   - 支持实时显示消息已读/未读状态。

4. **管理员面板**：
   - 包含用户管理界面，可查看所有用户信息，支持分页显示。
   - 提供白名单审核界面，管理员可处理用户的白名单申请。

（具体界面原型图可使用工具如 Figma 或 Adobe XD 绘制）

### 3.3.2 用户交互流程
用户与系统的交互流程如下：
1. 用户启动客户端，进入登录界面，可选择登录或注册新账户。
2. 登录成功后，进入主界面，用户可通过导航栏访问不同功能模块。
3. 在即时通讯模块中，用户可查看联系人列表，选择联系人进行聊天，发送和接收消息。
4. 用户可进行签到操作，获取每日奖励，并在排行榜中查看自己的排名。
5. 新用户可提交白名单申请，管理员通过管理面板审核申请。
6. 用户可随时查看和更新个人资料，修改个人设置。