# 《用户管理系统-桌面版》数据字典（Data Dictionary）
**作者**：SiNouBeea
**日期**：2025-10-22
**适用范围**：需求分析 → 设计 → 编码 → 测试全过程  

---

## 1. 说明
1.1 本字典只描述**数据流**（Data Flow），不描述数据库表结构。  
1.2 每一条数据流均按 IEEE-830 及 GB/T 8567-2020 给出的最小元数据集合进行定义。  
1.3 “组成”栏采用类 BNF 语法，约定：  
 `[ ]` 可选、`|` 多选一、`{ }` 重复、`→` 嵌套展开。  
1.4 所有数据元以**驼峰命名**保持一致，与源码、接口、文档同步。

---

## 2. 数据流条目（Data Flow Entries）

| 编号 | 数据流名称 | 别名 | 方向 | 组成 | 峰值 | 说明 |
|---|---|---|---|---|---|---|
| F1 | 注册请求 | RegisterReq | 用户→系统 | `{username, password, nickname, email, phone, playerName}` | ≤20 条/秒 | 前端必填校验通过后发出 |
| F2 | 注册响应 | RegisterResp | 系统→用户 | `{success, message}` | 同 F1 | 失败时给出具体冲突字段 |
| F3 | 登录请求 | LoginReq | 用户→系统 | `{username, password, clientIP}` | ≤50 条/秒 | 含客户端公网 IP 用于定位 |
| F4 | 登录响应 | LoginResp | 系统→用户 | `{success, user, onlineUsers, unreadCount, unreadDetails}` | 同 F3 | user 含 roleID、WhiteState 等 |
| F5 | 签到请求 | SignReq | 用户→系统 | `{userID}` | ≤200 条/秒 | 每日一次，服务端防刷 |
| F6 | 签到响应 | SignResp | 系统→用户 | `{success, reward{coin, star}}` | 同 F5 | 奖励随机，含暴击逻辑 |
| F7 | 排行榜请求 | LeaderboardReq | 用户→系统 | `{}` | ≤100 条/秒 | 无参，缓存 5 min |
| F8 | 排行榜响应 | LeaderboardResp | 系统→用户 | `{coin[], star[]}` | 同 F7 | 各 100 条，含 UID/Nick/值 |
| F9 | 个人资料请求 | ProfileReq | 用户→系统 | `{userID}` | ≤100 条/秒 | 可查看自己或他人 |
| F10 | 个人资料响应 | ProfileResp | 系统→用户 | `{success, user}` | 同 F9 | 含扩展字段 FirstName…Bio |
| F11 | 资料更新请求 | UpdateProfileReq | 用户→系统 | `{userID, nickname, email, phone, firstName, lastName, gender, birthday, bio}` | ≤20 条/秒 | 单字段更新也全量回写 |
| F12 | 资料更新响应 | UpdateProfileResp | 系统→用户 | `{success, message}` | 同 F11 | 返回最新资料快照 |
| F13 | 白名单申请请求 | WhitelistApplyReq | 用户→系统 | `{userID, playerName, genuine, reason}` | ≤10 条/秒 | 同一用户日限 3 次 |
| F14 | 白名单申请响应 | WhitelistApplyResp | 系统→用户 | `{success, message}` | 同 F13 | 文件方式持久化 |
| F15 | 白名单审批请求 | WhitelistAuditReq | 管理员→系统 | `{date, userID, playerName, approved}` | ≤5 条/秒 | 审批后移动文件并更新 DB |
| F16 | 白名单审批响应 | WhitelistAuditResp | 系统→管理员 | `{success, message}` | 同 F15 | 通过后同步 RCON 加白 |
| F17 | 权限更新请求 | RoleUpdateReq | 管理员→系统 | `{userID, newRoleID}` | ≤5 条/秒 | 只能升降级，不能跨管理 |
| F18 | 权限更新响应 | RoleUpdateResp | 系统→管理员 | `{success, message}` | 同 F17 | 即时生效，刷新在线状态 |
| F19 | 即时消息请求 | SendMsgReq | 用户→系统 | `{senderID, receiverID, content}` | ≤500 条/秒 | 内容≤250 字，敏感词过滤 |
| F20 | 即时消息响应 | SendMsgResp | 系统→用户 | `{success, message}` | 同 F19 | 成功后写 DB 并发推送 |
| F21 | 实时消息推送 | RealTimeMsgPush | 系统→用户 | `{type, message{senderID, receiverID, content, timestamp}}` | ≤500 条/秒 | 仅当 receiver 在线时推送 |
| F22 | 获取联系人请求 | GetContactsReq | 用户→系统 | `{userID}` | ≤100 条/秒 | 登录后自动拉取 |
| F23 | 获取联系人响应 | GetContactsResp | 系统→用户 | `{success, contacts[{UserID, Username, Nickname, remark, online}]}` | 同 F22 | 含备注与在线状态 |
| F24 | 获取历史消息请求 | GetHistoryMsgReq | 用户→系统 | `{userID, contactID}` | ≤200 条/秒 | 分页未用，全量拉取 |
| F25 | 获取历史消息响应 | GetHistoryMsgResp | 系统→用户 | `{success, messages[]}` | 同 F24 | 按时间升序，含系统赠与消息 |
| F26 | 标记已读请求 | MarkReadReq | 用户→系统 | `{userID, contactID}` | ≤200 条/秒 | 进入聊天页时触发 |
| F27 | 标记已读响应 | MarkReadResp | 系统→用户 | `{success, unreadCount, unreadDetails}` | 同 F26 | 更新未读徽标 |
| F28 | 获取未读数请求 | GetUnreadReq | 用户→系统 | `{userID}` | ≤50 条/秒 | 登录后首页刷新 |
| F29 | 获取未读数响应 | GetUnreadResp | 系统→用户 | `{success, unreadCount, unreadDetails}` | 同 F28 | unreadDetails 为 map |
| F30 | 赠与礼物请求 | GiveGiftReq | 用户→系统 | `{senderID, receiverID, giftType}` | ≤50 条/秒 | coin/star，每日上限 |
| F31 | 赠与礼物响应 | GiveGiftResp | 系统→用户 | `{success, amount, senderName, receiverName}` | 同 F30 | 写记录并推送系统消息 |
| F32 | 获取赠与信息请求 | GetGiftInfoReq | 用户→系统 | `{userID}` | ≤50 条/秒 | 打开赠与弹窗时调用 |
| F33 | 获取赠与信息响应 | GetGiftInfoResp | 系统→用户 | `{success, giftInfo{coinsGivenToday, starsGivenToday, coinLimit, starLimit}}` | 同 F32 | 用于客户端灰化按钮 |
| F34 | 添加联系人请求 | AddContactReq | 用户→系统 | `{userID, contactID, remark}` | ≤20 条/秒 | 不能加自己 |
| F35 | 添加联系人响应 | AddContactResp | 系统→用户 | `{success, message, contact}` | 同 F34 | 成功后自动发一条系统消息 |
| F36 | 删除联系人请求 | DelContactReq | 用户→系统 | `{userID, contactID}` | ≤20 条/秒 | 软删除，仅隐藏消息 |
| F37 | 删除联系人响应 | DelContactResp | 系统→用户 | `{success, message}` | 同 F36 | 同步清理备注文件 |
| F38 | 更新备注请求 | UpdateRemarkReq | 用户→系统 | `{userID, contactID, remark}` | ≤20 条/秒 | 长度≤20 字 |
| F39 | 更新备注响应 | UpdateRemarkResp | 系统→用户 | `{success, message}` | 同 F38 | 写本地 json 文件 |
| F40 | 用户上线通知 | UserOnlineNotice | 系统→所有在线用户 | `{type, onlineUsers[]}` | ≤100 条/秒 | 广播最新在线列表 |
| F41 | 用户下线通知 | UserOfflineNotice | 系统→所有在线用户 | 同 F40 | ≤100 条/秒 | 异常断开也触发 |

---

## 3. 数据元素条目（Data Element Entries）

| 元素名 | 别名 | 类型 | 长度 | 值域 | 说明 |
|---|---|---|---|---|---|
| userID | UID | uint | 4 | 1..2^31-1 | 全局自增主键 |
| username | 用户名 | string | 20 | 字母数字下划线，首位非数字 | 唯一索引 |
| password | 密码 | string | 60 | bcrypt 哈希 | 明文绝不落地 |
| nickname | 昵称 | string | 30 | 任意 UTF-8，除 <> | 可重复，可修改 |
| roleID | 角色编码 | uint | 1 | 1=管理 2=VIP 3=用户 4=游客 5=封禁 | 降级不能为 1 |
| whiteState | 白名单状态 | bool | 1 | 0/1 | 通过后同步游戏服 |
| online | 在线状态 | bool | 1 | 0/1 | 内存集合，掉线即清 |
| coin | 金币 | uint | 4 | 0..2^31-1 | 签到/赠与获得 |
| star | 星星 | uint | 4 | 0..2^31-1 | 稀有货币 |
| content | 消息内容 | string | 250 | 任意 UTF-8 | 实时敏感词过滤 |
| timestamp | 时间戳 | string | 19 | yyyy-MM-dd HH:mm:ss | 服务端统一，禁止客户端 |
| unreadCount | 未读数 | uint | 2 | 0..65535 | 仅统计，不具业务锁 |
| giftType | 礼物类型 | enum | 4 | "coin" \| "star" | 大小写敏感 |

---

## 4. 附录
A. 峰值估算按 1 千 DAU、平均在线 100 人、每人 30 次/小时请求模型计算。  
B. 所有时间均采用 Asia/Shanghai 时区，服务端生成，禁止客户端传入。  
