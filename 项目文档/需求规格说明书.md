# 《用户管理系统（桌面版）》需求规格说明书

&gt; 版本：v1.0  
&gt; 日期：2025-06-25  
&gt; 作者：SiiNouBeea  
&gt; 状态：评审稿

---

## 1. 引言
### 1.1 目的
本文档用于完整描述《用户管理系统（桌面版）》的功能需求、性能需求、质量属性及外部接口约束，为后续设计、编码、测试和验收提供唯一依据。

### 1.2 项目背景
现有 Minecraft 私服缺少统一、可视化的玩家管理平台。为提升运营效率、降低人工审核成本，需开发一套基于 PyQt5 的桌面客户端，通过 TCP-JSON 协议与后端（Python SocketServer + MySQL）交互，实现注册、登录、白名单审批、签到、个人资料维护、实时聊天及后台管理等功能。

---

## 2. 总体描述
### 2.1 产品视角
- 采用 C/S 架构：  
  - Client：PyQt5 桌面程序，负责 UI 与本地校验  
  - Server：Python 多线程 TCP 服务，负责业务逻辑与持久化  
- 单台服务器可并发支撑 ≥200 个桌面客户端（实测 4C8G 下 CPU≤60%）  
- 客户端可运行在 Windows10/11、Linux X11、macOS 10.15+（需 Python≥3.8）

### 2.2 产品功能（高层用例）
| 模块 | 一级功能 | 二级功能 |
|----|--------|--------|
| 注册 | 账号创建 | 字段校验、重名检查、邮箱/手机格式验证、密码加密 |
| 登录 | 身份认证 | 防重复登录、IP 地理位置记录、在线状态同步 |
| 白名单 | 申请/审批 | 每日 3 次上限、正版/离线标识、管理员一键通过/拒绝、RCON 自动下发 |
| 签到 | 每日签到 | 随机奖励（1-10 金币、5% 概率 1 星、1% 概率 5 星）、VIP 加成 |
| 个人资料 | 信息维护 | 头像、昵称、性别、生日、简介、密码修改 |
| 实时聊天 | 即时通信 | 联系人备注、未读红点、在线状态、消息已读、250 字限制、礼物赠与 |
| 后台管理 | 用户/权限 | 分页查询、角色升降级、白名单批量审批、在线列表、强制下线 |

### 2.3 用户特征
- 游客：仅浏览主页排行榜  
- 普通玩家：注册、登录、签到、聊天、申请白名单  
- VIP：签到奖励加成、每日可赠与 5 金币/1 星  
- 管理员：拥有全部后台功能，可修改任意用户角色与白名单状态  

### 2.4 假设与依赖
- 服务端已安装 MySQL 8.0+、Python 3.8+、MCRcon 可访问游戏服务器  
- 客户端可访问服务器 TCP-8000 端口及外网 ip-api.com（获取地理位置）  
- 所有用户具备基础计算机操作能力  

---

## 3. 功能需求
### 3.1 注册模块
| 编号 | 需求描述 | 验收标准 |
|----|---------|---------|
| REG-1 | 支持用户名、密码、昵称、邮箱、手机、游戏 ID 注册 | 提交后 1s 内返回结果，成功率≥99% |
| REG-2 | 用户名/邮箱/手机全局唯一 | 重复时提示“xxx 已被使用” |
| REG-3 | 客户端格式校验：邮箱正则、手机 1[3-9]\d{9} | 非法格式无法点击提交 |
| REG-4 | 密码 8-20 位，含大小写字母+数字 | 强度不足实时提示 |
| REG-5 | 注册成功后自动跳转登录页 | 无需重新输入用户名 |

### 3.2 登录模块
| 编号 | 需求描述 | 验收标准 |
|----|---------|---------|
| LOG-1 | 账号+密码登录 | 响应≤500ms |
| LOG-2 | 单点登录控制：同一账号禁止重复登录 | 第二次登录提示“已在其他地方登录” |
| LOG-3 | 记录 IP 与地理位置 | 后台可查看最近 30 条登录日志 |
| LOG-4 | 7 天免登录（本地 Token） | 重启客户端仍保持会话 |
| LOG-5 | 登出时上报离线状态 | 在线列表实时刷新 |

### 3.3 白名单模块
| 编号 | 需求描述 | 验收标准 |
|----|---------|---------|
| WL-1 | 玩家提交申请：玩家名、正版/离线、理由 | 字段均必填，理由≥10 字 |
| WL-2 | 每日最多 3 次申请 | 第 4 次提交提示“已达上限” |
| WL-3 | 管理员审批：通过/拒绝 | 审批后状态实时刷新，文件归档 |
| WL-4 | 通过时自动执行 RCON 命令 `whitelist add` | 游戏服务器 5s 内生效 |
| WL-5 | 已审批记录可查看历史 | 显示日期、审批人、结果 |

### 3.4 签到模块
| 编号 | 需求描述 | 验收标准 |
|----|---------|---------|
| SIGN-1 | 每日 0 点重置签到 | 0:00-0:01 之间允许重新签到 |
| SIGN-2 | 随机奖励算法可配置 | 通过修改 server.py 常量即可调整概率 |
| SIGN-3 | VIP 用户金币额外+1~5 | 角色表 RoleID≤2 即视为 VIP |
| SIGN-4 | 签到后刷新排行榜 | 排行榜延迟≤1s |

### 3.5 个人资料模块
| 编号 | 需求描述 | 验收标准 |
|----|---------|---------|
| PROF-1 | 显示基础信息：ID、昵称、金币、星星、角色、白名单、QQ 绑定 | 进入页面 1s 内加载完成 |
| PROF-2 | 编辑模式支持修改头像、昵称、邮箱、手机、性别、生日、简介 | 保存后即时刷新 |
| PROF-3 | 密码修改需二次确认 | 两次输入不一致按钮禁用 |
| PROF-4 | 资料修改记录留痕（日志文件） | 可追踪最近 20 次修改 |

### 3.6 实时聊天
| 编号 | 需求描述 | 验收标准 |
|----|---------|---------|
| CHAT-1 | 支持添加/删除联系人 | 删除后聊天记录隐藏 |
| CHAT-2 | 消息长度≤250 字 | 超出无法发送 |
| CHAT-3 | 未读红点实时计数 | 切换页面 200ms 内更新 |
| CHAT-4 | 在线状态：绿色在线/灰色离线 | 状态变化 2s 内同步 |
| CHAT-5 | 礼物赠与：金币每日 5 次、星星 1 次 | 赠与后发送富文本系统消息 |
| CHAT-6 | 消息已读标记 | 打开聊天窗口自动调用已读接口 |

### 3.7 管理员管理模块
| 编号 | 需求描述 | 验收标准 |
|----|---------|---------|
| ADMIN-1 | 用户管理：分页（10/页）、搜索、角色升降级 | 单页查询≤300ms |
| ADMIN-2 | 白名单审批：批量通过/拒绝 | 一次性勾选≤50 条 |
| ADMIN-3 | 强制用户下线 | 立即从在线列表移除 |
| ADMIN-4 | 查看全站统计：注册数、在线数、签到率 | 首页仪表盘 3s 内加载 |
| ADMIN-5 | 操作日志：记录管理员关键操作 | 日志保存 180 天 |

---

## 4. 性能需求
| 指标 | 目标值 | 备注 |
|----|-------|------|
| 客户端启动时间 | ≤3s | 含网络握手 |
| 登录接口响应 | ≤500ms | 含密码验证与 IP 解析 |
| 签到并发 100 TPS | 成功率≥99%，P95≤200ms | 使用线程池 |
| 聊天消息端到端延迟 | ≤1s | 局域网测试 |
| 排行榜 1000 行加载 | ≤300ms | 服务端一次性缓存 |
| 服务端稳定运行 | 7×24h | 内存泄漏≤50MB/周 |

---

## 5. 质量属性
- 可靠性：异常崩溃率≤0.1%/天，支持自动重连 3 次  
- 易用性：主要任务完成步骤≤3 步，提供操作提示与回滚  
- 可维护性：代码注释率≥20%，配置集中化（config.yaml）  
- 可扩展性：新增模块无需改动客户端框架，仅增加 qrc 资源与路由  
- 可移植性：Python 代码遵循 PEP8，无平台相关硬编码路径  
- 安全性：  
  – 密码 bcrypt 加密+salt，传输过程使用 TCP 自带流式校验  
  – 管理员接口仅 RoleID=1 可访问，服务端校验，客户端不缓存权限  
  – 防 SQL 注入：全部使用参数化查询  
  – 防重放：seq 字段单次有效，服务端缓存 60s 已处理 seq  

---

## 6. 外部接口
### 6.1 用户界面
- 登录/注册：模态对话框，支持 Enter 快捷键  
- 主界面：左侧导航栏 160px，顶部菜单栏 24px，状态栏 20px  
- 聊天：右侧消息区支持 Ctrl+Enter 发送，鼠标右键菜单  

### 6.2 软件接口
- TCP 通信：帧格式 `&gt;I` 4 字节长度 + JSON UTF-8 负载，心跳 30s  
- MySQL：8.0.x，字符集 utf8mb4，连接池最小 2 最大 10  
- MCRcon：1.1.0，支持 Minecraft 1.20+ whitelist 命令  

### 6.3 硬件接口
- 客户端：内存≥2GB，磁盘≥200MB，分辨率≥1280×720  
- 服务端：内存≥4GB，磁盘≥10GB，网络上行≥10Mbps  

### 6.4 通信接口
- 端口：TCP 8000（业务）+ TCP 25575（RCON）  
- 域名：可配置，支持 frp 内网穿透，客户端自动识别公网 IP  

---

## 7. 验收准则
- 功能：全部用例通过《验收测试用例表》（另附）  
- 性能：第 4 节指标在 4C8G 服务器、100M 局域网实测达标  
- 文档：代码注释、部署手册、运维手册齐全  
- 培训：提供 1 次管理员线上培训，时长 1h，含视频回放  

---

## 8. 附录
A. 术语表  
B. 缩略语  
C. 参考文档（Python3 文档、PyQt5 官方示例、Minecraft RCON 协议）  

&gt; 以上需求经甲乙双方评审确认后，签署《需求评审报告》，进入设计阶段。